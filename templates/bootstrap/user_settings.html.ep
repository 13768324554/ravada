<!DOCTYPE html>
<html ng-app="ravada.app">
%= include 'bootstrap/header'
<body id="page-top" data-spy="scroll" data-target=".navbar-fixed-top" role="document">
    <div id="wrapper">
    %= include 'bootstrap/navigation'
    <div id="page-wrapper">

        <!--BASES AND DOMAINS LIST-->
        <div ng-controller="userSettings">
            <div class="page-header">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h2 class="text-center"><%=l 'User Settings' %></h2>
                    </div>
                    <div>
%                           if (scalar @$errors) {
                                <div class="panel panel-danger">
                                    <div class="panel-heading">
%                                       for (@$errors) {
                                            <%= $_ %>
%                                       }
                                    </div>
                                </div>
%                         }
                        
                        <p><form method='post' enctype="multipart/form-data">
                            <%=l 'Language:' %> <select onchange="this.form.submit();" id="tongue" name="tongue" >
                                <option <%= $c->param("tongue") eq 'en' ? "selected" : "" %> value="en" ><%=l 'English' %></option>
                                <option <%= $c->param("tongue") eq 'ca' ? "selected" : "" %> value="ca" ><%=l 'Catalan' %></option>
                                <option <%= $c->param("tongue") eq 'es' ? "selected" : "" %> value="es" ><%=l 'Spanish' %></option>
                                <option <%= $c->param("tongue") eq 'gl' ? "selected" : "" %> value="gl" ><%=l 'Galician' %></option>
                                <option <%= $c->param("tongue") eq 'fr' ? "selected" : "" %> value="fr" ><%=l 'French' %></option>
                                <option <%= $c->param("tongue") eq 'id' ? "selected" : "" %> value="id" ><%=l 'Indonesian' %></option>
                                <option <%= $c->param("tongue") eq 'fa' ? "selected" : "" %> value="fa" ><%=l 'Persian' %></option>
                             </select>
%                            if ($changed_lang) {
                                 <font color="green">   <%=l 'Your language has been changed successfully' %></font> 
%                            }     
                        </form>                
                        </p>
%   if (!$_user->is_external) {
                        <hr>
                        <h3><%=l 'Password' %></h3>
                        <form method='post' enctype="multipart/form-data">
                            <p><%=l 'New Password:' %><input type= 'password' name= 'password' id='password'></p>
                            <p><%=l 'Confirm Password:' %><input type='password' name='conf_password' id='conf_password'></p>
                            <p><input type='submit' class="btn btn-primary" onclick='this.form.submit();' id='button_click' name='button_click' value='<%=l 'Submit' %>'></input>
%                               if ($changed_pass) {
                                    <font color="green">   <%=l 'Your password has been changed successfully' %></font> 
%                               }     
                            </p>
                        </form>
%   }
                        <hr>
                        <h3><%=l 'Security' %></h3>
%                            if ($change_2fa) {
                                <p><a href="#" data-toggle="modal" data-target="#dis2fa-modal"><%=l 'Manage two-factor authentication' %> <span class="label label-success"><i class="fa fa-lock" aria-hidden="true">&nbsp; On</i></span></a></p>
                                <div class="modal fade dis2fa-modal" id="dis2fa-modal" role="dialog" >
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                                                <h4 class="modal-title">Security</h4>
                                            </div>
                                            <div class="modal-body">
                                                <h4 class="list-item"><%=l 'Two-factor authentication' %><span class="label label-success"><i class="fa fa-lock" aria-hidden="true">&nbsp; On</i></span></h4>
                                                <p class="list-item"><%=l 'You\'ve enabled two-factor authentication by your account and you\'re receiving code by mobile app.' %></p>
                                            </div>
                                            <div class="modal-footer">
                                                <form method="post" enctype="multipart/form-data">
                                                <button type="button" class="btn btn-default" data-dismiss="modal"><%= l 'Close' %></button>
                                                <input type='submit' class="btn btn-danger" onclick='this.form.submit();' name='dis_2faclick' value='<%=l 'Yes, disable' %>'></input>
                                                </form>
                                            </div
                                        </div><!-- /.modal-content -->
                                    </div><!-- /.modal-dialog -->
                                </div><!-- /.modal -->
%                                       } else {
                                <p><a href="#" data-toggle="modal" data-target="#2fa-modal"><%=l 'Set up two-factor authentication' %> <span class="label label-default"><i class="fa fa-unlock" aria-hidden="true"></i>&nbsp; Off</span></a></p>
                                    <form method='post' enctype="multipart/form-data">
                                    <div class="modal fade 2fa-modal" id="2fa-modal" role="dialog" >
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                                                <h4 class="modal-title">Security</h4>
                                            </div>
                                            <div class="modal-body">
                                                <p class="list-item"><i class="fa fa-shield fa-fw fa-3x" aria-hidden="true"></i>&nbsp; <%=l 'It adds security. With this enabled, even if someone managed to get your password, they would also need your phone to log in to your account.' %></p>
                                                <p class="list-item"><i class="fa fa-mobile fa-fw fa-3x" aria-hidden="true"></i>&nbsp; <%=l 'You set up your phone to generate verification codes. Then, we\'ll prompt your enter these codes when you try to log in on a new computer or devide.' %></p>
                                            </div>
                                            <form method='post'>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                                <a type="button" class="btn btn-primary" data-toggle="modal" data-target="#2fa-modal2"><%=l 'Get started' %></a>
                                            </div>
                                            </form>
                                            </div><!-- /.modal-content -->
                                        </div><!-- /.modal-dialog -->
                                    </div><!-- /.modal -->
                                    </form>
                                    <div class="modal fade 2fa-modal2" id="2fa-modal2">
                                        <div class="modal-dialog">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                                                    <h4 class="modal-title">Security</h4>
                                                </div>
                                                <form method='post' enctype="multipart/form-data">
                                                <div class="modal-body">
                                                    <p class="list-item"><%=l 'Authenthication apps (like Google Authenticator or Authy) generate verification codes.' %></p>
                                                    <p class="list-item"><%=l '1. Open the app and scan the QR bardcode below.' %></p>
                                                    <p class="list-item"><img src="<%= $qrcode %>"/></p>
                                                    <p class="list-item"><%=l '2. Enter the verification code generated by the app.' %></p>
                                                    <input type="text" class="form-control required" name="form_code" placeholder="<%=l 'Enter code' %>" required/>
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-default" data-dismiss="modal">Back</button>
                                                    <input type='submit' class="btn btn-primary" onclick='this.form.submit();' name='qrcode_click' value='<%=l 'Enable' %>'></input>
                                                </div>
                                                </form>
                                            </div><!-- /.modal-content -->
                                        </div><!-- /.modal-dialog -->
                                    </div><!-- /.modal -->
%                                       }
<!--                        <hr>
                        <h3><%=l 'Login History' %></h3> -->
                  </div>
                </div>
            </div>
        </div>
    </div>
    </div>
</div>
%= include 'bootstrap/scripts'
%= include 'bootstrap/footer'
</body>
</html>
